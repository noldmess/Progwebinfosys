<script src="/socket.io/socket.io.js"></script>
<script src="/js/jquery.js"></script>
<script>
	if (!window.location.origin){
    	window.location.origin = window.location.protocol+"//"+window.location.host;
	}
	var socket = io.connect(window.location.origin);

	// direkt bei der Verbindung die serverseite Funktion 'newUser' aufrufen, um den User am Chat anzumelden
	socket.on('connect', function(){
		socket.emit('newUser');
	});

	// wenn der Server 'updateChat' aufruft, wird der Chat mit den übergebenen erweitert. 
	socket.on('updateChat', function (username, data) {
		$('#conversation').append('<b>'+username + ':</b> ' + data + '<br>');
		$('#conversation').scrollTop($('#conversation')[0].scrollHeight);
	});

	// wenn der Server 'updateUsers' aufruft, wird die Liste der angemeldeten User erneuert
	socket.on('updateUsers', function(data) {
		$('#users').empty();
		$.each(data, function(key, value) {
			$('#users').append('<div>' + value.name + '</div>');
		});
	});
	
	// wenn der Server 'setName' aufruft, wird der Name des aktuellen Users gesetzt
	socket.on('setName', function(name){
		$('#user').empty();
		$('#user').append('Angemeldet als: '+name);
	});
	
	// wird vom Server aufgerufen wenn der User den Befehl /quit verwendet oder ein anderer User diesen mit dem 
	// Befehl /kick: aus den Chat ausschließt
	socket.on('quitConnection', function(data){
		$('#quit').empty();
		/*
		* TODO 
		* Do muasch olls ondre ausblenden und es div 'quit' inblenden mit dr nochricht wos in data steat!!!!
		*/
	});

	// on load of page
	$(function(){
		// wenn der User auf 'Senden' klickt 
		$('#datasend').click( function() {
			var message = $('#data').val();

			//Nachricht senden
			socket.emit('sendMsg', message);
			$('#data').focus();
			$('#data').val('');
		});

		// Listener auf die Tastatur für die Enter Taste, Klick auf 'Senden'-Button wird simuliert
		$('#data').keypress(function(e) {
			if(e.which == 13) {
				e.preventDefault();
				$(this).blur();
				$('#datasend').focus().click();
			}
		});
	});

</script>
<div style="float:left;width:200px;border-right:1px solid black;height:450px;padding:10px;overflow-y:scroll;">
	<div id="user"></div>
	<b>USERS</b>
	<div id="users"></div>
</div>
<div style="float:left;width:300px;height:450px;padding:10px;">
	<div id="conversation" style="height:350px;overflow-y:scroll;"></div>
	<textarea id="data" rows="5" columns="200" ></textarea>
	<input type="button" id="datasend" value="Senden" />
</div>
<div id="quit" style="display:none;"></div>
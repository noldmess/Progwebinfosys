<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Gruppe 2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="http://138.232.66.90/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <link href="http://138.232.66.90/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="http://138.232.66.90/css/override.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets<?php echo str_replace("\\", "/", dirname($_SERVER['SCRIPT_NAME']));?>js/html5shiv.js"></script>
    <![endif]-->


  </head>

  <body>
    <script>
    
	$( document ).ready(function() {
		$('.node').attr('href', window.location.protocol + "//" + window.location.hostname + ":8080/");
	});
    </script>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="nav-collapse collapse">
            <ul class="nav">
             <!--<li><a href="<?php echo  str_replace("\\", "/", dirname($_SERVER['SCRIPT_NAME']));?>wiki/">Wiki</a></li>-->
             <li> <a href="https:/github.com/noldmess/Progwebinfosys">GIT</a></li>
             <li><a href="http:/138.232.66.90//zend1/">Zend-Game</a></li>
             <li><a href="http:/138.232.66.90//zend2/">Zend-Game(SPA 1)</a></li>
             <li><a href="http:/138.232.66.90//zend3/">Zend-Game(SPA 2)</a></li>
             <li><a class="node" href="/">Chat</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

<script src="/socket.io/socket.io.js"></script>
<script src="/js/jquery.js"></script>
<script>
	if (!window.location.origin){
    	window.location.origin = window.location.protocol+"//"+window.location.host;
	}
	var socket = io.connect(window.location.origin);

	// direkt bei der Verbindung die serverseite Funktion 'newUser' aufrufen, um den User am Chat anzumelden
	socket.on('connect', function(){
		socket.emit('newUser');
	});

	// wenn der Server 'updateChat' aufruft, wird der Chat mit den �bergebenen erweitert. 
	socket.on('updateChat', function (username, data) {
		$('#conversation').append('<b>'+username + ':</b> ' + data + '<br>');
		$('#conversation').scrollTop($('#conversation')[0].scrollHeight);
	});

	// wenn der Server 'updateUsers' aufruft, wird die Liste der angemeldeten User erneuert
	socket.on('updateUsers', function(data) {
		$('#users').empty();
		$.each(data, function(key, value) {
			$('#users').append('<div>' + value.name + '</div>');
		});
	});
	
	// wenn der Server 'setName' aufruft, wird der Name des aktuellen Users gesetzt
	socket.on('setName', function(name){
		$('#user').empty();
		$('#user').append('Angemeldet als: '+name);
	});
	
	// wird vom Server aufgerufen wenn der User den Befehl /quit verwendet oder ein anderer User diesen mit dem 
	// Befehl /kick: aus den Chat ausschlie�t
	socket.on('quitConnection', function(data){
		$('#quit').empty();
		/*
		* TODO 
		* Do muasch olls ondre ausblenden und es div 'quit' inblenden mit dr nochricht wos in data steat!!!!
		*/
	});

	// on load of page
	$(function(){
		// wenn der User auf 'Senden' klickt 
		$('#datasend').click( function() {
			var message = $('#data').val();

			//Nachricht senden
			socket.emit('sendMsg', message);
			$('#data').focus();
			$('#data').val('');
		});

		// Listener auf die Tastatur f�r die Enter Taste, Klick auf 'Senden'-Button wird simuliert
		$('#data').keypress(function(e) {
			if(e.which == 13) {
				e.preventDefault();
				$(this).blur();
				$('#datasend').focus().click();
			}
		});
	});

</script>
<div class="row-fluid">
	<div class="span3">
		<div class="well sidebar-nav">
			<div style="float:left;width:200px;border-right:1px solid black;height:450px;padding:10px;overflow-y:scroll;">
				<div id="user"></div>
				<b>USERS</b>
				<div id="users"></div>
		</div>
	</div>
</div>
<div class="span9">
	<div class="hero-unit">
		<div style="float:left;width:300px;height:450px;padding:10px;">
			<div id="conversation" style="height:350px;overflow-y:scroll;"></div>
			<textarea id="data" rows="5" columns="200" ></textarea>
			<input type="button" id="datasend" value="Senden" />
		</div>
	</div>
</div>
<div id="quit" style="display:none;"></div>
</div>
<footer>
        <p>&copy; Aaron Messner, Markus M&uuml;ller - 2013 <?php if(isset($TEMPLATE['time'])){echo 'Time to load Page: '.$TEMPLATE['time'];}?></p>
</footer>

</div><!--/.fluid-container-->
</body>
</html>
